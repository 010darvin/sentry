{"version":3,"file":"chunks/app_views_dataExport_dataDownload_tsx.xxxxxxxxxxxxxxxxxxxx.js","mappings":"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","sources":["webpack:///./app/components/dataExport.tsx","webpack:///./app/views/asyncView.tsx","webpack:///./app/views/dataExport/dataDownload.tsx"],"sourcesContent":["import {useCallback, useEffect, useRef, useState} from 'react';\nimport debounce from 'lodash/debounce';\n\nimport {addErrorMessage, addSuccessMessage} from 'sentry/actionCreators/indicator';\nimport {Client} from 'sentry/api';\nimport Feature from 'sentry/components/acl/feature';\nimport Button from 'sentry/components/button';\nimport {t} from 'sentry/locale';\nimport {Organization} from 'sentry/types';\nimport withApi from 'sentry/utils/withApi';\nimport withOrganization from 'sentry/utils/withOrganization';\n\n// NOTE: Coordinate with other ExportQueryType (src/sentry/data_export/base.py)\nexport enum ExportQueryType {\n  IssuesByTag = 'Issues-by-Tag',\n  Discover = 'Discover',\n}\n\ninterface DataExportPayload {\n  queryInfo: any;\n  queryType: ExportQueryType; // TODO(ts): Formalize different possible payloads\n}\n\ninterface DataExportProps {\n  api: Client;\n  organization: Organization;\n  payload: DataExportPayload;\n  children?: React.ReactNode;\n  disabled?: boolean;\n  icon?: React.ReactNode;\n}\n\nfunction DataExport({\n  api,\n  children,\n  disabled,\n  organization,\n  payload,\n  icon,\n}: DataExportProps): React.ReactElement {\n  const unmountedRef = useRef(false);\n  const [inProgress, setInProgress] = useState(false);\n\n  // We clear the indicator if export props change so that the user\n  // can fire another export without having to wait for the previous one to finish.\n  useEffect(() => {\n    if (inProgress) {\n      setInProgress(false);\n    }\n    // We are skipping the inProgress dependency because it would have fired on each handleDataExport\n    // call and would have immediately turned off the value giving users no feedback on their click action.\n    // An alternative way to handle this would have probably been to key the component by payload/queryType,\n    // but that seems like it can be a complex object so tracking changes could result in very brittle behavior.\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [payload.queryType, payload.queryInfo]);\n\n  // Tracking unmounting of the component to prevent setState call on unmounted component\n  useEffect(() => {\n    return () => {\n      unmountedRef.current = true;\n    };\n  }, []);\n\n  const handleDataExport = useCallback(() => {\n    setInProgress(true);\n\n    // This is a fire and forget request.\n    api\n      .requestPromise(`/organizations/${organization.slug}/data-export/`, {\n        includeAllArgs: true,\n        method: 'POST',\n        data: {\n          query_type: payload.queryType,\n          query_info: payload.queryInfo,\n        },\n      })\n      .then(([_data, _, response]) => {\n        // If component has unmounted, don't do anything\n        if (unmountedRef.current) {\n          return;\n        }\n\n        addSuccessMessage(\n          response?.status === 201\n            ? t(\n                \"Sit tight. We'll shoot you an email when your data is ready for download.\"\n              )\n            : t(\"It looks like we're already working on it. Sit tight, we'll email you.\")\n        );\n      })\n      .catch(err => {\n        // If component has unmounted, don't do anything\n        if (unmountedRef.current) {\n          return;\n        }\n        const message =\n          err?.responseJSON?.detail ??\n          \"We tried our hardest, but we couldn't export your data. Give it another go.\";\n\n        addErrorMessage(t(message));\n        setInProgress(false);\n      });\n  }, [payload.queryInfo, payload.queryType, organization.slug, api]);\n\n  return (\n    <Feature features={['organizations:discover-query']}>\n      {inProgress ? (\n        <Button\n          size=\"sm\"\n          priority=\"default\"\n          title=\"You can get on with your life. We'll email you when your data's ready.\"\n          disabled\n          icon={icon}\n        >\n          {t(\"We're working on it...\")}\n        </Button>\n      ) : (\n        <Button\n          onClick={debounce(handleDataExport, 500)}\n          disabled={disabled || false}\n          size=\"sm\"\n          priority=\"default\"\n          title=\"Put your data to work. Start your export and we'll email you when it's finished.\"\n          icon={icon}\n        >\n          {children ? children : t('Export All to CSV')}\n        </Button>\n      )}\n    </Feature>\n  );\n}\n\nexport {DataExport};\nexport default withApi(withOrganization(DataExport));\n","import AsyncComponent from 'sentry/components/asyncComponent';\nimport SentryDocumentTitle from 'sentry/components/sentryDocumentTitle';\n\ntype AsyncViewState = AsyncComponent['state'];\ntype AsyncViewProps = AsyncComponent['props'];\n\nexport default class AsyncView<\n  P extends AsyncViewProps = AsyncViewProps,\n  S extends AsyncViewState = AsyncViewState\n> extends AsyncComponent<P, S> {\n  getTitle() {\n    return '';\n  }\n\n  render() {\n    return (\n      <SentryDocumentTitle title={this.getTitle()}>\n        {this.renderComponent() as React.ReactChild}\n      </SentryDocumentTitle>\n    );\n  }\n}\n","import {Fragment} from 'react';\nimport {browserHistory, RouteComponentProps} from 'react-router';\nimport styled from '@emotion/styled';\n\nimport Button from 'sentry/components/button';\nimport {ExportQueryType} from 'sentry/components/dataExport';\nimport DateTime from 'sentry/components/dateTime';\nimport {IconDownload} from 'sentry/icons';\nimport {t, tct} from 'sentry/locale';\nimport space from 'sentry/styles/space';\nimport AsyncView from 'sentry/views/asyncView';\nimport Layout from 'sentry/views/auth/layout';\n\nexport enum DownloadStatus {\n  Early = 'EARLY',\n  Valid = 'VALID',\n  Expired = 'EXPIRED',\n}\n\ntype RouteParams = {\n  dataExportId: string;\n  orgId: string;\n};\n\ntype Download = {\n  checksum: string;\n  dateCreated: string;\n  id: number;\n  query: {\n    info: object;\n    type: ExportQueryType;\n  };\n  status: DownloadStatus;\n  user: {\n    email: string;\n    id: number;\n    username: string;\n  };\n  dateExpired?: string;\n  dateFinished?: string;\n};\n\ntype Props = {} & RouteComponentProps<RouteParams, {}>;\n\ntype State = {\n  download: Download;\n  errors: {\n    download: {\n      responseJSON: {\n        detail: string;\n      };\n      status: number;\n      statusText: string;\n    };\n  };\n} & AsyncView['state'];\n\nclass DataDownload extends AsyncView<Props, State> {\n  disableErrorReport = false;\n\n  getTitle(): string {\n    return t('Download Center');\n  }\n\n  getEndpoints(): ReturnType<AsyncView['getEndpoints']> {\n    const {orgId, dataExportId} = this.props.params;\n    return [['download', `/organizations/${orgId}/data-export/${dataExportId}/`]];\n  }\n\n  getActionLink(queryType): string {\n    const {orgId} = this.props.params;\n    switch (queryType) {\n      case ExportQueryType.IssuesByTag:\n        return `/organizations/${orgId}/issues/`;\n      case ExportQueryType.Discover:\n        return `/organizations/${orgId}/discover/queries/`;\n      default:\n        return '/';\n    }\n  }\n\n  renderDate(date: string | undefined): React.ReactNode {\n    if (!date) {\n      return null;\n    }\n    const d = new Date(date);\n    return (\n      <strong>\n        <DateTime date={d} />\n      </strong>\n    );\n  }\n\n  renderEarly(): React.ReactNode {\n    return (\n      <Fragment>\n        <Header>\n          <h3>\n            {t('What are')}\n            <i>{t(' you ')}</i>\n            {t('doing here?')}\n          </h3>\n        </Header>\n        <Body>\n          <p>\n            {t(\n              \"Not that its any of our business, but were you invited to this page? It's just that we don't exactly remember emailing you about it.\"\n            )}\n          </p>\n          <p>{t(\"Close this window and we'll email you when your download is ready.\")}</p>\n        </Body>\n      </Fragment>\n    );\n  }\n\n  renderExpired(): React.ReactNode {\n    const {query} = this.state.download;\n    const actionLink = this.getActionLink(query.type);\n    return (\n      <Fragment>\n        <Header>\n          <h3>{t('This is awkward.')}</h3>\n        </Header>\n        <Body>\n          <p>\n            {t(\n              \"That link expired, so your download doesn't live here anymore. Just picked up one day and left town.\"\n            )}\n          </p>\n          <p>\n            {t(\n              'Make a new one with your latest data. Your old download will never see it coming.'\n            )}\n          </p>\n          <DownloadButton href={actionLink} priority=\"primary\">\n            {t('Start a New Download')}\n          </DownloadButton>\n        </Body>\n      </Fragment>\n    );\n  }\n\n  openInDiscover() {\n    const {\n      download: {\n        query: {info},\n      },\n    } = this.state;\n    const {orgId} = this.props.params;\n\n    const to = {\n      pathname: `/organizations/${orgId}/discover/results/`,\n      query: info,\n    };\n\n    browserHistory.push(to);\n  }\n\n  renderOpenInDiscover() {\n    const {\n      download: {\n        query = {\n          type: ExportQueryType.IssuesByTag,\n          info: {},\n        },\n      },\n    } = this.state;\n\n    // default to IssuesByTag because we don't want to\n    // display this unless we're sure its a discover query\n    const {type = ExportQueryType.IssuesByTag} = query;\n\n    return type === 'Discover' ? (\n      <Fragment>\n        <p>{t('Need to make changes?')}</p>\n        <Button priority=\"primary\" onClick={() => this.openInDiscover()}>\n          {t('Open in Discover')}\n        </Button>\n        <br />\n      </Fragment>\n    ) : null;\n  }\n\n  renderValid(): React.ReactNode {\n    const {\n      download: {dateExpired, checksum},\n    } = this.state;\n    const {orgId, dataExportId} = this.props.params;\n\n    return (\n      <Fragment>\n        <Header>\n          <h3>{t('All done.')}</h3>\n        </Header>\n        <Body>\n          <p>{t(\"See, that wasn't so bad. Your data is all ready for download.\")}</p>\n          <Button\n            priority=\"primary\"\n            icon={<IconDownload />}\n            href={`/api/0/organizations/${orgId}/data-export/${dataExportId}/?download=true`}\n          >\n            {t('Download CSV')}\n          </Button>\n          <p>\n            {t(\"That link won't last forever — it expires:\")}\n            <br />\n            {this.renderDate(dateExpired)}\n          </p>\n          {this.renderOpenInDiscover()}\n          <p>\n            <small>\n              <strong>SHA1:{checksum}</strong>\n            </small>\n            <br />\n            {tct('Need help verifying? [link].', {\n              link: (\n                <a\n                  href=\"https://docs.sentry.io/product/discover-queries/query-builder/#filter-by-table-columns\"\n                  target=\"_blank\"\n                  rel=\"noopener noreferrer\"\n                >\n                  {t('Check out our docs')}\n                </a>\n              ),\n            })}\n          </p>\n        </Body>\n      </Fragment>\n    );\n  }\n\n  renderError(): React.ReactNode {\n    const {\n      errors: {download: err},\n    } = this.state;\n    const errDetail = err?.responseJSON?.detail;\n    return (\n      <Layout>\n        <main>\n          <Header>\n            <h3>\n              {err.status} - {err.statusText}\n            </h3>\n          </Header>\n          {errDetail && (\n            <Body>\n              <p>{errDetail}</p>\n            </Body>\n          )}\n        </main>\n      </Layout>\n    );\n  }\n\n  renderContent(): React.ReactNode {\n    const {download} = this.state;\n    switch (download.status) {\n      case DownloadStatus.Early:\n        return this.renderEarly();\n      case DownloadStatus.Expired:\n        return this.renderExpired();\n      default:\n        return this.renderValid();\n    }\n  }\n\n  renderBody() {\n    return (\n      <Layout>\n        <main>{this.renderContent()}</main>\n      </Layout>\n    );\n  }\n}\n\nconst Header = styled('header')`\n  border-bottom: 1px solid ${p => p.theme.border};\n  padding: ${space(3)} 40px 0;\n  h3 {\n    font-size: 24px;\n    margin: 0 0 ${space(3)} 0;\n  }\n`;\n\nconst Body = styled('div')`\n  padding: ${space(2)} 40px;\n  max-width: 500px;\n  p {\n    margin: ${space(1.5)} 0;\n  }\n`;\n\nconst DownloadButton = styled(Button)`\n  margin-bottom: ${space(1.5)};\n`;\n\nexport default DataDownload;\n"],"names":["useCallback","useEffect","useRef","useState","debounce","addErrorMessage","addSuccessMessage","Feature","Button","t","withApi","withOrganization","ExportQueryType","DataExport","api","children","disabled","organization","payload","icon","unmountedRef","inProgress","setInProgress","queryType","queryInfo","current","handleDataExport","requestPromise","slug","includeAllArgs","method","data","query_type","query_info","then","_data","_","response","status","catch","err","message","responseJSON","detail","AsyncComponent","SentryDocumentTitle","AsyncView","getTitle","render","renderComponent","Fragment","browserHistory","DateTime","IconDownload","tct","space","Layout","DownloadStatus","DataDownload","getEndpoints","orgId","dataExportId","props","params","getActionLink","IssuesByTag","Discover","renderDate","date","d","Date","renderEarly","renderExpired","query","state","download","actionLink","type","openInDiscover","info","to","pathname","push","renderOpenInDiscover","renderValid","dateExpired","checksum","link","renderError","errors","errDetail","statusText","renderContent","Early","Expired","renderBody","Header","p","theme","border","Body","DownloadButton"],"sourceRoot":""}