{"version":3,"file":"chunks/app_components_forms_teamSelector_tsx.xxxxxxxxxxxxxxxxxxxx.js","mappings":"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","sources":["webpack:///./app/components/forms/teamSelector.tsx"],"sourcesContent":["import {useRef} from 'react';\nimport {StylesConfig} from 'react-select';\nimport styled from '@emotion/styled';\nimport debounce from 'lodash/debounce';\n\nimport {addTeamToProject} from 'sentry/actionCreators/projects';\nimport Button from 'sentry/components/button';\nimport SelectControl, {\n  ControlProps,\n  GeneralSelectValue,\n} from 'sentry/components/forms/selectControl';\nimport IdBadge from 'sentry/components/idBadge';\nimport Tooltip from 'sentry/components/tooltip';\nimport {DEFAULT_DEBOUNCE_DURATION} from 'sentry/constants';\nimport {IconAdd, IconUser} from 'sentry/icons';\nimport {t} from 'sentry/locale';\nimport space from 'sentry/styles/space';\nimport {Organization, Project, Team} from 'sentry/types';\nimport {isActiveSuperuser} from 'sentry/utils/isActiveSuperuser';\nimport useApi from 'sentry/utils/useApi';\nimport useTeams from 'sentry/utils/useTeams';\nimport withOrganization from 'sentry/utils/withOrganization';\n\nconst UnassignedWrapper = styled('div')`\n  display: flex;\n  align-items: center;\n`;\n\nconst StyledIconUser = styled(IconUser)`\n  margin-left: ${space(0.25)};\n  margin-right: ${space(1)};\n  color: ${p => p.theme.gray400};\n`;\n\n// An option to be unassigned on the team dropdown\nconst unassignedOption = {\n  value: null,\n  label: (\n    <UnassignedWrapper>\n      <StyledIconUser size=\"20px\" />\n      {t('Unassigned')}\n    </UnassignedWrapper>\n  ),\n  searchKey: 'unassigned',\n  actor: null,\n  disabled: false,\n};\n\n// Ensures that the svg icon is white when selected\nconst unassignedSelectStyles: StylesConfig = {\n  option: (provided, state) => ({\n    ...provided,\n    svg: {\n      color: state.isSelected && state.theme.white,\n    },\n  }),\n};\n\nconst placeholderSelectStyles: StylesConfig = {\n  input: (provided, state) => ({\n    ...provided,\n    display: 'grid',\n    gridTemplateColumns: 'max-content 1fr',\n    alignItems: 'center',\n    gridGap: space(1),\n    ':before': {\n      backgroundColor: state.theme.backgroundSecondary,\n      height: 24,\n      width: 24,\n      borderRadius: 3,\n      content: '\"\"',\n      display: 'block',\n    },\n  }),\n  placeholder: provided => ({\n    ...provided,\n    paddingLeft: 32,\n  }),\n};\n\ntype Props = {\n  onChange: (value: any) => any;\n  organization: Organization;\n  includeUnassigned?: boolean;\n  /**\n   * Can be used to restrict teams to a certain project and allow for new teams to be add to that project\n   */\n  project?: Project;\n  /**\n   * Function to control whether a team should be shown in the dropdown\n   */\n  teamFilter?: (team: Team) => boolean;\n  /**\n   * Controls whether the value in the dropdown is a team id or team slug\n   */\n  useId?: boolean;\n} & ControlProps;\n\ntype TeamActor = {\n  id: string;\n  name: string;\n  type: 'team';\n};\n\ntype TeamOption = GeneralSelectValue & {\n  actor: TeamActor | null;\n  searchKey: string;\n};\n\nfunction TeamSelector(props: Props) {\n  const {includeUnassigned, styles, ...extraProps} = props;\n  const {teamFilter, organization, project, multiple, value, useId, onChange} = props;\n\n  const api = useApi();\n  const {teams, fetching, onSearch} = useTeams();\n\n  // TODO(ts) This type could be improved when react-select types are better.\n  const selectRef = useRef<any>(null);\n\n  const createTeamOption = (team: Team): TeamOption => ({\n    value: useId ? team.id : team.slug,\n    label: `#${team.slug}`,\n    leadingItems: <IdBadge team={team} hideName />,\n    searchKey: team.slug,\n    actor: {\n      type: 'team',\n      id: team.id,\n      name: team.slug,\n    },\n  });\n\n  /**\n   * Closes the select menu by blurring input if possible since that seems to\n   * be the only way to close it.\n   */\n  function closeSelectMenu() {\n    if (!selectRef.current) {\n      return;\n    }\n\n    const select = selectRef.current.select;\n    const input: HTMLInputElement = select.inputRef;\n\n    if (input) {\n      // I don't think there's another way to close `react-select`\n      input.blur();\n    }\n  }\n\n  async function handleAddTeamToProject(team: Team) {\n    if (!project) {\n      closeSelectMenu();\n      return;\n    }\n\n    // Copy old value\n    const oldValue = multiple ? [...(value ?? [])] : {value};\n    // Optimistic update\n    onChange?.(createTeamOption(team));\n\n    try {\n      await addTeamToProject(api, organization.slug, project.slug, team);\n    } catch (err) {\n      // Unable to add team to project, revert select menu value\n      onChange?.(oldValue);\n    }\n\n    closeSelectMenu();\n  }\n\n  function createTeamOutsideProjectOption(team: Team): TeamOption {\n    // If the option/team is currently selected, optimistically assume it is now a part of the project\n    if (value === (useId ? team.id : team.slug)) {\n      return createTeamOption(team);\n    }\n    const canAddTeam = organization.access.includes('project:write');\n\n    return {\n      ...createTeamOption(team),\n      disabled: true,\n      label: `#${team.slug}`,\n      leadingItems: <IdBadge team={team} hideName />,\n      trailingItems: (\n        <Tooltip\n          title={\n            canAddTeam\n              ? t('Add %s to project', `#${team.slug}`)\n              : t('You do not have permission to add team to project.')\n          }\n          containerDisplayMode=\"flex\"\n        >\n          <AddToProjectButton\n            type=\"button\"\n            size=\"zero\"\n            borderless\n            disabled={!canAddTeam}\n            onClick={() => handleAddTeamToProject(team)}\n            icon={<IconAdd isCircled />}\n            aria-label={t('Add %s to project', `#${team.slug}`)}\n          />\n        </Tooltip>\n      ),\n      tooltip: t('%s is not a member of project', `#${team.slug}`),\n    };\n  }\n\n  function getOptions() {\n    const isSuperuser = isActiveSuperuser();\n    const filteredTeams = isSuperuser\n      ? teams\n      : teamFilter\n      ? teams.filter(teamFilter)\n      : teams;\n\n    if (project) {\n      const teamsInProjectIdSet = new Set(project.teams.map(team => team.id));\n      const teamsInProject = filteredTeams.filter(team =>\n        teamsInProjectIdSet.has(team.id)\n      );\n      const teamsNotInProject = filteredTeams.filter(\n        team => !teamsInProjectIdSet.has(team.id)\n      );\n\n      return [\n        ...teamsInProject.map(createTeamOption),\n        ...teamsNotInProject.map(createTeamOutsideProjectOption),\n        ...(includeUnassigned ? [unassignedOption] : []),\n      ];\n    }\n\n    return [\n      ...filteredTeams.map(createTeamOption),\n      ...(includeUnassigned ? [unassignedOption] : []),\n    ];\n  }\n\n  return (\n    <SelectControl\n      ref={selectRef}\n      options={getOptions()}\n      onInputChange={debounce(val => void onSearch(val), DEFAULT_DEBOUNCE_DURATION)}\n      getOptionValue={option => option.searchKey}\n      styles={{\n        ...(includeUnassigned ? unassignedSelectStyles : {}),\n        ...(multiple ? {} : placeholderSelectStyles),\n        ...(styles ?? {}),\n      }}\n      isLoading={fetching}\n      {...extraProps}\n    />\n  );\n}\n\nconst AddToProjectButton = styled(Button)`\n  flex-shrink: 0;\n`;\n\nexport {TeamSelector};\n\n// TODO(davidenwang): this is broken due to incorrect types on react-select\nexport default withOrganization(TeamSelector) as unknown as (\n  p: Omit<Props, 'organization'>\n) => JSX.Element;\n"],"names":["useRef","debounce","addTeamToProject","Button","SelectControl","IdBadge","Tooltip","DEFAULT_DEBOUNCE_DURATION","IconAdd","IconUser","t","space","isActiveSuperuser","useApi","useTeams","withOrganization","UnassignedWrapper","StyledIconUser","p","theme","gray400","unassignedOption","value","label","searchKey","actor","disabled","unassignedSelectStyles","option","provided","state","svg","color","isSelected","white","placeholderSelectStyles","input","display","gridTemplateColumns","alignItems","gridGap","backgroundColor","backgroundSecondary","height","width","borderRadius","content","placeholder","paddingLeft","TeamSelector","props","includeUnassigned","styles","extraProps","teamFilter","organization","project","multiple","useId","onChange","api","teams","fetching","onSearch","selectRef","createTeamOption","team","id","slug","leadingItems","type","name","closeSelectMenu","current","select","inputRef","blur","handleAddTeamToProject","oldValue","err","createTeamOutsideProjectOption","canAddTeam","access","includes","trailingItems","tooltip","getOptions","isSuperuser","filteredTeams","filter","teamsInProjectIdSet","Set","map","teamsInProject","has","teamsNotInProject","val","AddToProjectButton"],"sourceRoot":""}