{"version":3,"file":"chunks/app_views_settings_organizationTeams_teamNotifications_tsx.xxxxxxxxxxxxxxxxxxxx.js","mappings":"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","sources":["webpack:///./app/views/asyncView.tsx","webpack:///./app/views/settings/organizationTeams/teamNotifications.tsx"],"sourcesContent":["import AsyncComponent from 'sentry/components/asyncComponent';\nimport SentryDocumentTitle from 'sentry/components/sentryDocumentTitle';\n\ntype AsyncViewState = AsyncComponent['state'];\ntype AsyncViewProps = AsyncComponent['props'];\n\nexport default class AsyncView<\n  P extends AsyncViewProps = AsyncViewProps,\n  S extends AsyncViewState = AsyncViewState\n> extends AsyncComponent<P, S> {\n  getTitle() {\n    return '';\n  }\n\n  render() {\n    return (\n      <SentryDocumentTitle title={this.getTitle()}>\n        {this.renderComponent() as React.ReactChild}\n      </SentryDocumentTitle>\n    );\n  }\n}\n","import {RouteComponentProps} from 'react-router';\nimport styled from '@emotion/styled';\n\nimport {addErrorMessage, addSuccessMessage} from 'sentry/actionCreators/indicator';\nimport AsyncComponent from 'sentry/components/asyncComponent';\nimport Button from 'sentry/components/button';\nimport Confirm from 'sentry/components/confirm';\nimport TextField from 'sentry/components/forms/textField';\nimport ExternalLink from 'sentry/components/links/externalLink';\nimport {Panel, PanelBody, PanelHeader} from 'sentry/components/panels';\nimport Tooltip from 'sentry/components/tooltip';\nimport {IconDelete} from 'sentry/icons';\nimport {t, tct} from 'sentry/locale';\nimport space from 'sentry/styles/space';\nimport {ExternalTeam, Integration, Organization, Team} from 'sentry/types';\nimport {toTitleCase} from 'sentry/utils';\nimport withOrganization from 'sentry/utils/withOrganization';\nimport AsyncView from 'sentry/views/asyncView';\nimport EmptyMessage from 'sentry/views/settings/components/emptyMessage';\n\ntype Props = RouteComponentProps<{orgId: string; teamId: string}, {}> & {\n  organization: Organization;\n  team: Team;\n};\n\ntype State = AsyncView['state'] & {\n  integrations: Integration[];\n  teamDetails: Team;\n};\n\nconst DOCS_LINK =\n  'https://docs.sentry.io/product/integrations/notification-incidents/slack/#team-notifications';\nconst NOTIFICATION_PROVIDERS = ['slack'];\n\nclass TeamNotificationSettings extends AsyncView<Props, State> {\n  getTitle() {\n    return 'Team Notification Settings';\n  }\n\n  getEndpoints(): ReturnType<AsyncComponent['getEndpoints']> {\n    const {organization, team} = this.props;\n    return [\n      [\n        'teamDetails',\n        `/teams/${organization.slug}/${team.slug}/`,\n        {query: {expand: ['externalTeams']}},\n      ],\n      [\n        'integrations',\n        `/organizations/${organization.slug}/integrations/`,\n        {query: {includeConfig: 0}},\n      ],\n    ];\n  }\n\n  handleDelete = async (mapping: ExternalTeam) => {\n    try {\n      const {organization, team} = this.props;\n      const endpoint = `/teams/${organization.slug}/${team.slug}/external-teams/${mapping.id}/`;\n      await this.api.requestPromise(endpoint, {\n        method: 'DELETE',\n      });\n      addSuccessMessage(t('Deletion successful'));\n      this.fetchData();\n    } catch {\n      addErrorMessage(t('An error occurred'));\n    }\n  };\n\n  renderBody() {\n    return (\n      <Panel>\n        <PanelHeader>{t('Notifications')}</PanelHeader>\n        <PanelBody>{this.renderPanelBody()}</PanelBody>\n      </Panel>\n    );\n  }\n\n  renderPanelBody() {\n    const {organization} = this.props;\n    const {teamDetails, integrations} = this.state;\n\n    const notificationIntegrations = integrations.filter(integration =>\n      NOTIFICATION_PROVIDERS.includes(integration.provider.key)\n    );\n    if (!notificationIntegrations.length) {\n      return (\n        <EmptyMessage>\n          {t('No Notification Integrations have been installed yet.')}\n        </EmptyMessage>\n      );\n    }\n\n    const externalTeams = (teamDetails.externalTeams || []).filter(externalTeam =>\n      NOTIFICATION_PROVIDERS.includes(externalTeam.provider)\n    );\n\n    if (!externalTeams.length) {\n      return (\n        <EmptyMessage>\n          <div>{t('No teams have been linked yet.')}</div>\n          <NotDisabledSubText>\n            {tct('Head over to Slack and type [code] to get started. [link].', {\n              code: <code>/sentry link team</code>,\n              link: <ExternalLink href={DOCS_LINK}>{t('Learn more')}</ExternalLink>,\n            })}\n          </NotDisabledSubText>\n        </EmptyMessage>\n      );\n    }\n\n    const integrationsById = Object.fromEntries(\n      notificationIntegrations.map(integration => [integration.id, integration])\n    );\n\n    const access = new Set(organization.access);\n    const hasAccess = access.has('team:write');\n\n    return externalTeams.map(externalTeam => (\n      <FormFieldWrapper key={externalTeam.id}>\n        <StyledFormField\n          disabled\n          label={\n            <div>\n              <NotDisabledText>\n                {toTitleCase(externalTeam.provider)}:\n                {integrationsById[externalTeam.integrationId].name}\n              </NotDisabledText>\n              <NotDisabledSubText>\n                {tct('Unlink this channel in Slack with [code]. [link].', {\n                  code: <code>/sentry unlink team</code>,\n                  link: <ExternalLink href={DOCS_LINK}>{t('Learn more')}</ExternalLink>,\n                })}\n              </NotDisabledSubText>\n            </div>\n          }\n          name=\"externalName\"\n          value={externalTeam.externalName}\n        />\n        <DeleteButtonWrapper>\n          <Tooltip\n            title={t(\n              'You must be an organization owner, manager or admin to remove a Slack team link'\n            )}\n            disabled={hasAccess}\n          >\n            <Confirm\n              disabled={!hasAccess}\n              onConfirm={() => this.handleDelete(externalTeam)}\n              message={t('Are you sure you want to remove this Slack team link?')}\n            >\n              <Button\n                size=\"sm\"\n                icon={<IconDelete size=\"md\" />}\n                aria-label={t('delete')}\n                disabled={!hasAccess}\n              />\n            </Confirm>\n          </Tooltip>\n        </DeleteButtonWrapper>\n      </FormFieldWrapper>\n    ));\n  }\n}\nexport default withOrganization(TeamNotificationSettings);\n\nconst NotDisabledText = styled('div')`\n  color: ${p => p.theme.textColor};\n  line-height: ${space(2)};\n`;\nconst NotDisabledSubText = styled('div')`\n  color: ${p => p.theme.subText};\n  font-size: ${p => p.theme.fontSizeRelativeSmall};\n  line-height: 1.4;\n  margin-top: ${space(1)};\n`;\nconst FormFieldWrapper = styled('div')`\n  display: flex;\n  align-items: center;\n  justify-content: flex-start;\n`;\nconst StyledFormField = styled(TextField)`\n  flex: 1;\n`;\nconst DeleteButtonWrapper = styled('div')`\n  margin-right: ${space(4)};\n  padding-right: ${space(0.5)};\n`;\n"],"names":["AsyncComponent","SentryDocumentTitle","AsyncView","getTitle","render","renderComponent","addErrorMessage","addSuccessMessage","Button","Confirm","TextField","ExternalLink","Panel","PanelBody","PanelHeader","Tooltip","IconDelete","t","tct","space","toTitleCase","withOrganization","EmptyMessage","DOCS_LINK","NOTIFICATION_PROVIDERS","TeamNotificationSettings","mapping","organization","team","props","endpoint","slug","id","api","requestPromise","method","fetchData","getEndpoints","query","expand","includeConfig","renderBody","renderPanelBody","teamDetails","integrations","state","notificationIntegrations","filter","integration","includes","provider","key","length","externalTeams","externalTeam","code","link","integrationsById","Object","fromEntries","map","access","Set","hasAccess","has","integrationId","name","externalName","handleDelete","NotDisabledText","p","theme","textColor","NotDisabledSubText","subText","fontSizeRelativeSmall","FormFieldWrapper","StyledFormField","DeleteButtonWrapper"],"sourceRoot":""}