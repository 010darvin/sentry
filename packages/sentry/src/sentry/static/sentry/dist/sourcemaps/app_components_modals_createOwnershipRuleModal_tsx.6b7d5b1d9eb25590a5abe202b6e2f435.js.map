{"version":3,"file":"chunks/app_components_modals_createOwnershipRuleModal_tsx.xxxxxxxxxxxxxxxxxxxx.js","mappings":"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","sources":["webpack:///./app/components/modals/createOwnershipRuleModal.tsx","webpack:///./app/views/settings/project/projectOwnership/modal.tsx"],"sourcesContent":["import {Fragment, useCallback, useEffect, useRef} from 'react';\nimport {css} from '@emotion/react';\n\nimport {ModalRenderProps} from 'sentry/actionCreators/modal';\nimport {t} from 'sentry/locale';\nimport theme from 'sentry/utils/theme';\nimport ProjectOwnershipModal from 'sentry/views/settings/project/projectOwnership/modal';\n\ntype Props = ModalRenderProps &\n  Pick<ProjectOwnershipModal['props'], 'organization' | 'project' | 'issueId'> & {\n    onClose?: () => void;\n  };\n\nconst CreateOwnershipRuleModal = ({Body, Header, closeModal, ...props}: Props) => {\n  const closeModalTimeoutRef = useRef<number | undefined>(undefined);\n\n  useEffect(() => {\n    return () => {\n      window.clearInterval(closeModalTimeoutRef.current);\n    };\n  }, []);\n\n  const handleSuccess = useCallback(() => {\n    props.onClose?.();\n    window.clearTimeout(closeModalTimeoutRef.current);\n    closeModalTimeoutRef.current = window.setTimeout(closeModal, 2000);\n  }, [props.onClose]);\n\n  return (\n    <Fragment>\n      <Header closeButton>{t('Create Ownership Rule')}</Header>\n      <Body>\n        <ProjectOwnershipModal {...props} onSave={handleSuccess} />\n      </Body>\n    </Fragment>\n  );\n};\n\nexport const modalCss = css`\n  @media (min-width: ${theme.breakpoints.small}) {\n    width: 80%;\n  }\n  [role='document'] {\n    overflow: initial;\n  }\n`;\n\nexport default CreateOwnershipRuleModal;\n","import {Fragment} from 'react';\nimport uniq from 'lodash/uniq';\n\nimport AsyncComponent from 'sentry/components/asyncComponent';\nimport {t} from 'sentry/locale';\nimport {Frame, Organization, Project, TagWithTopValues} from 'sentry/types';\nimport {Entry, EventError} from 'sentry/types/event';\nimport OwnerInput from 'sentry/views/settings/project/projectOwnership/ownerInput';\n\ntype IssueOwnershipResponse = {\n  autoAssignment: boolean;\n  dateCreated: string;\n  fallthrough: boolean;\n  isActive: boolean;\n  lastUpdated: string;\n  raw: string;\n};\n\ntype Props = AsyncComponent['props'] & {\n  issueId: string;\n  onSave: () => void;\n  organization: Organization;\n  project: Project;\n};\n\ntype State = {\n  eventData: null | EventError;\n  ownership: null | IssueOwnershipResponse;\n  urlTagData: null | TagWithTopValues;\n} & AsyncComponent['state'];\n\nclass ProjectOwnershipModal extends AsyncComponent<Props, State> {\n  getEndpoints(): ReturnType<AsyncComponent['getEndpoints']> {\n    const {organization, project, issueId} = this.props;\n    return [\n      ['ownership', `/projects/${organization.slug}/${project.slug}/ownership/`],\n      [\n        'urlTagData',\n        `/issues/${issueId}/tags/url/`,\n        {},\n        {\n          allowError: error =>\n            // Allow for 404s\n            error.status === 404,\n        },\n      ],\n      ['eventData', `/issues/${issueId}/events/latest/`],\n    ];\n  }\n\n  renderBody() {\n    const {ownership, urlTagData, eventData} = this.state;\n    if (!ownership && !urlTagData && !eventData) {\n      return null;\n    }\n    const urls = urlTagData\n      ? urlTagData.topValues\n          .sort((a, b) => a.count - b.count)\n          .map(i => i.value)\n          .slice(0, 5)\n      : [];\n\n    // pull frame data out of exception or the stacktrace\n    const entry = (eventData?.entries as Entry[]).find(({type}) =>\n      ['exception', 'stacktrace'].includes(type)\n    );\n\n    let frames: Frame[] = [];\n    if (entry?.type === 'exception') {\n      frames = entry?.data?.values?.[0]?.stacktrace?.frames ?? [];\n    }\n    if (entry?.type === 'stacktrace') {\n      frames = entry?.data?.frames ?? [];\n    }\n\n    // filter frames by inApp unless there would be 0\n    const inAppFrames = frames.filter(frame => frame.inApp);\n    if (inAppFrames.length > 0) {\n      frames = inAppFrames;\n    }\n\n    const paths = uniq(frames.map(frame => frame.filename || frame.absPath || ''))\n      .filter(i => i)\n      .slice(0, 30);\n\n    return (\n      <Fragment>\n        <p>{t('Match against Issue Data: (globbing syntax *, ? supported)')}</p>\n        <OwnerInput\n          {...this.props}\n          initialText={ownership?.raw || ''}\n          urls={urls}\n          paths={paths}\n        />\n      </Fragment>\n    );\n  }\n}\n\nexport default ProjectOwnershipModal;\n"],"names":["Fragment","useCallback","useEffect","useRef","css","t","theme","ProjectOwnershipModal","CreateOwnershipRuleModal","Body","Header","closeModal","props","closeModalTimeoutRef","undefined","window","clearInterval","current","handleSuccess","onClose","clearTimeout","setTimeout","modalCss","breakpoints","small","uniq","AsyncComponent","OwnerInput","getEndpoints","organization","project","issueId","slug","allowError","error","status","renderBody","ownership","urlTagData","eventData","state","urls","topValues","sort","a","b","count","map","i","value","slice","entry","entries","find","type","includes","frames","data","values","stacktrace","inAppFrames","filter","frame","inApp","length","paths","filename","absPath","raw"],"sourceRoot":""}