{"version":3,"file":"chunks/app_components_projects_missingProjectMembership_tsx.xxxxxxxxxxxxxxxxxxxx.js","mappings":"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","sources":["webpack:///./app/components/projects/missingProjectMembership.tsx"],"sourcesContent":["import {Component} from 'react';\nimport styled from '@emotion/styled';\n\nimport {addErrorMessage, addSuccessMessage} from 'sentry/actionCreators/indicator';\nimport {joinTeam} from 'sentry/actionCreators/teams';\nimport {Client} from 'sentry/api';\nimport Button from 'sentry/components/button';\nimport SelectControl from 'sentry/components/forms/selectControl';\nimport {Panel} from 'sentry/components/panels';\nimport {IconFlag} from 'sentry/icons';\nimport {t} from 'sentry/locale';\nimport TeamStore from 'sentry/stores/teamStore';\nimport space from 'sentry/styles/space';\nimport {Organization, Project} from 'sentry/types';\nimport withApi from 'sentry/utils/withApi';\nimport EmptyMessage from 'sentry/views/settings/components/emptyMessage';\n\ntype Props = {\n  api: Client;\n  organization: Organization;\n  project?: Project | null;\n};\n\ntype State = {\n  error: boolean;\n  loading: boolean;\n  team: string | null;\n  project?: Project | null;\n};\n\nclass MissingProjectMembership extends Component<Props, State> {\n  state: State = {\n    loading: false,\n    error: false,\n    project: this.props.project,\n    team: '',\n  };\n\n  joinTeam(teamSlug: string) {\n    this.setState({\n      loading: true,\n    });\n\n    joinTeam(\n      this.props.api,\n      {\n        orgId: this.props.organization.slug,\n        teamId: teamSlug,\n      },\n      {\n        success: () => {\n          this.setState({\n            loading: false,\n            error: false,\n          });\n          addSuccessMessage(t('Request to join team sent.'));\n        },\n        error: () => {\n          this.setState({\n            loading: false,\n            error: true,\n          });\n          addErrorMessage(t('There was an error while trying to request access.'));\n        },\n      }\n    );\n  }\n\n  renderJoinTeam(teamSlug: string, features: Set<string>) {\n    const team = TeamStore.getBySlug(teamSlug);\n\n    if (!team) {\n      return null;\n    }\n    if (this.state.loading) {\n      if (features.has('open-membership')) {\n        return <Button busy>{t('Join Team')}</Button>;\n      }\n      return <Button busy>{t('Request Access')}</Button>;\n    }\n    if (team?.isPending) {\n      return <Button disabled>{t('Request Pending')}</Button>;\n    }\n    if (features.has('open-membership')) {\n      return (\n        <Button\n          priority=\"primary\"\n          type=\"button\"\n          onClick={this.joinTeam.bind(this, teamSlug)}\n        >\n          {t('Join Team')}\n        </Button>\n      );\n    }\n    return (\n      <Button\n        priority=\"primary\"\n        type=\"button\"\n        onClick={this.joinTeam.bind(this, teamSlug)}\n      >\n        {t('Request Access')}\n      </Button>\n    );\n  }\n\n  getTeamsForAccess() {\n    const request: string[] = [];\n    const pending: string[] = [];\n    const teams = this.state.project?.teams ?? [];\n    teams.forEach(({slug}) => {\n      const team = TeamStore.getBySlug(slug);\n      if (!team) {\n        return;\n      }\n      team.isPending ? pending.push(team.slug) : request.push(team.slug);\n    });\n\n    return [request, pending];\n  }\n\n  getPendingTeamOption = (team: string) => {\n    return {\n      value: team,\n      label: <DisabledLabel>{t(`#${team}`)}</DisabledLabel>,\n    };\n  };\n\n  render() {\n    const {organization} = this.props;\n    const teamSlug = this.state.team;\n    const teams = this.state.project?.teams ?? [];\n    const features = new Set(organization.features);\n\n    const teamAccess = [\n      {\n        label: t('Request Access'),\n        options: this.getTeamsForAccess()[0].map(request => ({\n          value: request,\n          label: t(`#${request}`),\n        })),\n      },\n      {\n        label: t('Pending Requests'),\n        options: this.getTeamsForAccess()[1].map(pending =>\n          this.getPendingTeamOption(pending)\n        ),\n      },\n    ];\n\n    return (\n      <StyledPanel>\n        {!teams.length ? (\n          <EmptyMessage icon={<IconFlag size=\"xl\" />}>\n            {t(\n              'No teams have access to this project yet. Ask an admin to add your team to this project.'\n            )}\n          </EmptyMessage>\n        ) : (\n          <EmptyMessage\n            icon={<IconFlag size=\"xl\" />}\n            title={t(\"You're not a member of this project.\")}\n            description={t(\n              `You'll need to join a team with access before you can view this data.`\n            )}\n            action={\n              <Field>\n                <StyledSelectControl\n                  name=\"select\"\n                  placeholder={t('Select a Team')}\n                  options={teamAccess}\n                  onChange={teamObj => {\n                    const team = teamObj ? teamObj.value : null;\n                    this.setState({team});\n                  }}\n                />\n                {teamSlug ? (\n                  this.renderJoinTeam(teamSlug, features)\n                ) : (\n                  <Button disabled>{t('Select a Team')}</Button>\n                )}\n              </Field>\n            }\n          />\n        )}\n      </StyledPanel>\n    );\n  }\n}\n\nconst StyledPanel = styled(Panel)`\n  margin: ${space(2)} 0;\n`;\n\nconst Field = styled('div')`\n  display: grid;\n  grid-auto-flow: column;\n  gap: ${space(2)};\n  text-align: left;\n`;\n\nconst StyledSelectControl = styled(SelectControl)`\n  width: 250px;\n`;\n\nconst DisabledLabel = styled('div')`\n  display: flex;\n  opacity: 0.5;\n  overflow: hidden;\n`;\n\nexport default withApi(MissingProjectMembership);\n"],"names":["Component","addErrorMessage","addSuccessMessage","joinTeam","Button","SelectControl","Panel","IconFlag","t","TeamStore","space","withApi","EmptyMessage","MissingProjectMembership","loading","error","project","props","team","value","label","teamSlug","setState","api","orgId","organization","slug","teamId","success","renderJoinTeam","features","getBySlug","state","has","isPending","bind","getTeamsForAccess","request","pending","teams","forEach","push","render","Set","teamAccess","options","map","getPendingTeamOption","length","teamObj","StyledPanel","Field","StyledSelectControl","DisabledLabel"],"sourceRoot":""}