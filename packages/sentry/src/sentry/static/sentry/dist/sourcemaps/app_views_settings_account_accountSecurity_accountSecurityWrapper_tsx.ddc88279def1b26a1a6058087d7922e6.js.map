{"version":3,"file":"chunks/app_views_settings_account_accountSecurity_accountSecurityWrapper_tsx.xxxxxxxxxxxxxxxxxxxx.js","mappings":"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","sources":["webpack:///./app/views/settings/account/accountSecurity/accountSecurityWrapper.tsx"],"sourcesContent":["import {cloneElement} from 'react';\nimport {RouteComponentProps} from 'react-router';\n\nimport {addErrorMessage} from 'sentry/actionCreators/indicator';\nimport AsyncComponent from 'sentry/components/asyncComponent';\nimport {t} from 'sentry/locale';\nimport {Authenticator, OrganizationSummary, UserEmail} from 'sentry/types';\nimport {defined} from 'sentry/utils';\n\nconst ENDPOINT = '/users/me/authenticators/';\n\ntype Props = {\n  children: React.ReactElement;\n} & RouteComponentProps<{authId: string}, {}> &\n  AsyncComponent['props'];\n\ntype State = {\n  emails: UserEmail[];\n  authenticators?: Authenticator[] | null;\n  organizations?: OrganizationSummary[];\n} & AsyncComponent['state'];\n\nclass AccountSecurityWrapper extends AsyncComponent<Props, State> {\n  getEndpoints(): ReturnType<AsyncComponent['getEndpoints']> {\n    return [\n      ['authenticators', ENDPOINT],\n      ['organizations', '/organizations/'],\n      ['emails', '/users/me/emails/'],\n    ];\n  }\n\n  handleDisable = async (auth: Authenticator) => {\n    if (!auth || !auth.authId) {\n      return;\n    }\n\n    this.setState({loading: true});\n\n    try {\n      await this.api.requestPromise(`${ENDPOINT}${auth.authId}/`, {method: 'DELETE'});\n      this.remountComponent();\n    } catch (_err) {\n      this.setState({loading: false});\n      addErrorMessage(t('Error disabling %s', auth.name));\n    }\n  };\n\n  handleRegenerateBackupCodes = async () => {\n    this.setState({loading: true});\n\n    try {\n      await this.api.requestPromise(`${ENDPOINT}${this.props.params.authId}/`, {\n        method: 'PUT',\n      });\n      this.remountComponent();\n    } catch (_err) {\n      this.setState({loading: false});\n      addErrorMessage(t('Error regenerating backup codes'));\n    }\n  };\n  handleRefresh = () => {\n    this.fetchData();\n  };\n\n  renderBody() {\n    const {children} = this.props;\n    const {authenticators, organizations, emails} = this.state;\n    const enrolled =\n      authenticators?.filter(auth => auth.isEnrolled && !auth.isBackupInterface) || [];\n    const countEnrolled = enrolled.length;\n    const orgsRequire2fa = organizations?.filter(org => org.require2FA) || [];\n    const deleteDisabled = orgsRequire2fa.length > 0 && countEnrolled === 1;\n    const hasVerifiedEmail = !!emails?.find(({isVerified}) => isVerified);\n\n    // This happens when you switch between children views and the next child\n    // view is lazy loaded, it can potentially be `null` while the code split\n    // package is being fetched\n    if (!defined(children)) {\n      return null;\n    }\n\n    return cloneElement(this.props.children, {\n      onDisable: this.handleDisable,\n      onRegenerateBackupCodes: this.handleRegenerateBackupCodes,\n      authenticators,\n      deleteDisabled,\n      orgsRequire2fa,\n      countEnrolled,\n      hasVerifiedEmail,\n      handleRefresh: this.handleRefresh,\n    });\n  }\n}\n\nexport default AccountSecurityWrapper;\n"],"names":["cloneElement","addErrorMessage","AsyncComponent","t","defined","ENDPOINT","AccountSecurityWrapper","auth","authId","setState","loading","api","requestPromise","method","remountComponent","_err","name","props","params","fetchData","getEndpoints","renderBody","children","authenticators","organizations","emails","state","enrolled","filter","isEnrolled","isBackupInterface","countEnrolled","length","orgsRequire2fa","org","require2FA","deleteDisabled","hasVerifiedEmail","find","isVerified","onDisable","handleDisable","onRegenerateBackupCodes","handleRegenerateBackupCodes","handleRefresh"],"sourceRoot":""}