{"version":3,"file":"chunks/app_views_admin_adminUserEdit_tsx.xxxxxxxxxxxxxxxxxxxx.js","mappings":"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","sources":["webpack:///./app/views/admin/adminUserEdit.tsx","webpack:///./app/views/asyncView.tsx"],"sourcesContent":["import {Component, Fragment} from 'react';\nimport {browserHistory, RouteComponentProps} from 'react-router';\nimport styled from '@emotion/styled';\n\nimport {addErrorMessage, addSuccessMessage} from 'sentry/actionCreators/indicator';\nimport {ModalRenderProps, openModal} from 'sentry/actionCreators/modal';\nimport Button from 'sentry/components/button';\nimport RadioGroup from 'sentry/components/forms/controls/radioGroup';\nimport Form from 'sentry/components/forms/form';\nimport JsonForm from 'sentry/components/forms/jsonForm';\nimport FormModel from 'sentry/components/forms/model';\nimport {JsonFormObject} from 'sentry/components/forms/type';\nimport {t} from 'sentry/locale';\nimport space from 'sentry/styles/space';\nimport {User} from 'sentry/types';\nimport AsyncView from 'sentry/views/asyncView';\n\nconst userEditForm: JsonFormObject = {\n  title: 'User details',\n  fields: [\n    {\n      name: 'name',\n      type: 'string',\n      required: true,\n      label: t('Name'),\n    },\n    {\n      name: 'username',\n      type: 'string',\n      required: true,\n      label: t('Username'),\n      help: t('The username is the unique id of the user in the system'),\n    },\n    {\n      name: 'email',\n      type: 'string',\n      required: true,\n      label: t('Email'),\n      help: t('The users primary email address'),\n    },\n    {\n      name: 'isActive',\n      type: 'boolean',\n      required: true,\n      label: t('Active'),\n      help: t(\n        'Designates whether this user should be treated as active. Unselect this instead of deleting accounts.'\n      ),\n    },\n    {\n      name: 'isStaff',\n      type: 'boolean',\n      required: true,\n      label: t('Admin'),\n      help: t('Designates whether this user can perform administrative functions.'),\n    },\n    {\n      name: 'isSuperuser',\n      type: 'boolean',\n      required: true,\n      label: t('Superuser'),\n      help: t(\n        'Designates whether this user has all permissions without explicitly assigning them.'\n      ),\n    },\n  ],\n};\n\nconst REMOVE_BUTTON_LABEL = {\n  disable: t('Disable User'),\n  delete: t('Permanently Delete User'),\n};\n\ntype DeleteType = 'disable' | 'delete';\n\ntype RemoveModalProps = ModalRenderProps & {\n  onRemove: (type: DeleteType) => void;\n  user: User;\n};\n\ntype RemoveModalState = {\n  deleteType: DeleteType;\n};\n\nclass RemoveUserModal extends Component<RemoveModalProps, RemoveModalState> {\n  state: RemoveModalState = {\n    deleteType: 'disable',\n  };\n\n  onRemove = () => {\n    this.props.onRemove(this.state.deleteType);\n    this.props.closeModal();\n  };\n\n  render() {\n    const {user} = this.props;\n    const {deleteType} = this.state;\n\n    return (\n      <Fragment>\n        <RadioGroup\n          value={deleteType}\n          label={t('Remove user %s', user.email)}\n          onChange={type => this.setState({deleteType: type})}\n          choices={[\n            ['disable', t('Disable the account.')],\n            ['delete', t('Permanently remove the user and their data.')],\n          ]}\n        />\n        <ModalFooter>\n          <Button priority=\"danger\" onClick={this.onRemove}>\n            {REMOVE_BUTTON_LABEL[deleteType]}\n          </Button>\n          <Button onClick={this.props.closeModal}>{t('Cancel')}</Button>\n        </ModalFooter>\n      </Fragment>\n    );\n  }\n}\n\ntype Props = AsyncView['props'] & RouteComponentProps<{id: string}, {}>;\n\ntype State = AsyncView['state'] & {\n  user: User | null;\n};\n\nclass AdminUserEdit extends AsyncView<Props, State> {\n  get userEndpoint() {\n    const {params} = this.props;\n    return `/users/${params.id}/`;\n  }\n\n  getEndpoints(): ReturnType<AsyncView['getEndpoints']> {\n    return [['user', this.userEndpoint]];\n  }\n\n  async deleteUser() {\n    await this.api.requestPromise(this.userEndpoint, {\n      method: 'DELETE',\n      data: {hardDelete: true, organizations: []},\n    });\n\n    addSuccessMessage(t(\"%s's account has been deleted.\", this.state.user?.email));\n    browserHistory.replace('/manage/users/');\n  }\n\n  async deactivateUser() {\n    const response = await this.api.requestPromise(this.userEndpoint, {\n      method: 'PUT',\n      data: {isActive: false},\n    });\n\n    this.setState({user: response});\n    this.formModel.setInitialData(response);\n    addSuccessMessage(t(\"%s's account has been deactivated.\", response.email));\n  }\n\n  removeUser = (actionTypes: DeleteType) =>\n    actionTypes === 'delete' ? this.deleteUser() : this.deactivateUser();\n\n  formModel = new FormModel();\n\n  renderBody() {\n    const {user} = this.state;\n\n    if (user === null) {\n      return null;\n    }\n\n    const openDeleteModal = () =>\n      openModal(opts => (\n        <RemoveUserModal user={user} onRemove={this.removeUser} {...opts} />\n      ));\n\n    return (\n      <Fragment>\n        <h3>{t('Users')}</h3>\n        <p>{t('Editing user: %s', user.email)}</p>\n        <Form\n          model={this.formModel}\n          initialData={user}\n          apiMethod=\"PUT\"\n          apiEndpoint={this.userEndpoint}\n          requireChanges\n          onSubmitError={addErrorMessage}\n          onSubmitSuccess={data => {\n            this.setState({user: data});\n            addSuccessMessage('User account updated.');\n          }}\n          extraButton={\n            <Button\n              type=\"button\"\n              onClick={openDeleteModal}\n              style={{marginLeft: space(1)}}\n              priority=\"danger\"\n            >\n              {t('Remove User')}\n            </Button>\n          }\n        >\n          <JsonForm forms={[userEditForm]} />\n        </Form>\n      </Fragment>\n    );\n  }\n}\n\nconst ModalFooter = styled('div')`\n  display: grid;\n  grid-auto-flow: column;\n  gap: ${space(1)};\n  justify-content: end;\n  padding: 20px 30px;\n  margin: 20px -30px -30px;\n  border-top: 1px solid ${p => p.theme.border};\n`;\n\nexport default AdminUserEdit;\n","import AsyncComponent from 'sentry/components/asyncComponent';\nimport SentryDocumentTitle from 'sentry/components/sentryDocumentTitle';\n\ntype AsyncViewState = AsyncComponent['state'];\ntype AsyncViewProps = AsyncComponent['props'];\n\nexport default class AsyncView<\n  P extends AsyncViewProps = AsyncViewProps,\n  S extends AsyncViewState = AsyncViewState\n> extends AsyncComponent<P, S> {\n  getTitle() {\n    return '';\n  }\n\n  render() {\n    return (\n      <SentryDocumentTitle title={this.getTitle()}>\n        {this.renderComponent() as React.ReactChild}\n      </SentryDocumentTitle>\n    );\n  }\n}\n"],"names":["Component","Fragment","browserHistory","addErrorMessage","addSuccessMessage","openModal","Button","RadioGroup","Form","JsonForm","FormModel","t","space","AsyncView","userEditForm","title","fields","name","type","required","label","help","REMOVE_BUTTON_LABEL","disable","delete","RemoveUserModal","deleteType","props","onRemove","state","closeModal","render","user","email","setState","AdminUserEdit","actionTypes","deleteUser","deactivateUser","userEndpoint","params","id","getEndpoints","api","requestPromise","method","data","hardDelete","organizations","replace","response","isActive","formModel","setInitialData","renderBody","openDeleteModal","opts","removeUser","marginLeft","ModalFooter","p","theme","border","AsyncComponent","SentryDocumentTitle","getTitle","renderComponent"],"sourceRoot":""}