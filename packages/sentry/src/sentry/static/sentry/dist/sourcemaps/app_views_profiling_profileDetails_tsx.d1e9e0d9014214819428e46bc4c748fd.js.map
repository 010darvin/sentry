{"version":3,"file":"chunks/app_views_profiling_profileDetails_tsx.xxxxxxxxxxxxxxxxxxxx.js","mappings":"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","sources":["webpack:///./app/utils/profiling/units/units.ts","webpack:///./app/utils/useEffectAfterFirstRender.ts","webpack:///./app/views/profiling/profileDetails.tsx"],"sourcesContent":["export function relativeChange(final: number, initial: number): number {\n  return (final - initial) / initial;\n}\n\ntype Unit = 'nanoseconds' | 'microseconds' | 'milliseconds' | 'seconds';\n\nconst durationMappings: Record<Unit, number> = {\n  nanoseconds: 1e-9,\n  microseconds: 1e-6,\n  milliseconds: 1e-3,\n  seconds: 1,\n};\n\nconst format = (v: number, abbrev: string, precision: number) => {\n  return v.toFixed(precision) + abbrev;\n};\n\nexport function makeFormatter(from: Unit | string): (value: number) => string {\n  const multiplier = durationMappings[from];\n\n  if (multiplier === undefined) {\n    throw new Error(`Cannot format from unit ${from}, duration mapping is not defined`);\n  }\n\n  return (value: number) => {\n    const duration = value * multiplier;\n\n    if (duration >= 1) {\n      return format(duration, 's', 2);\n    }\n    if (duration / 1e-3 >= 1) {\n      return format(duration / 1e-3, 'ms', 2);\n    }\n    if (duration / 1e-6 >= 1) {\n      return format(duration / 1e-6, 'Î¼s', 2);\n    }\n    return format(duration / 1e-9, 'ns', 2);\n  };\n}\n\nfunction pad(n: number, slots: number) {\n  return Math.floor(n).toString().padStart(slots, '0');\n}\n\nexport function makeTimelineFormatter(from: Unit | string) {\n  const multiplier = durationMappings[from];\n\n  if (multiplier === undefined) {\n    throw new Error(`Cannot format from unit ${from}, duration mapping is not defined`);\n  }\n\n  return (value: number) => {\n    const s = value * multiplier;\n    const m = s / 60;\n    const ms = s * 1e3;\n\n    return `${pad(m, 2)}:${pad(s % 60, 2)}.${pad(ms % 1e3, 3)}`;\n  };\n}\n","import {useEffect, useRef} from 'react';\n\nconst useEffectAfterFirstRender = (\n  cb: React.EffectCallback,\n  deps: React.DependencyList\n): void => {\n  const firstRender = useRef<boolean>(true);\n\n  useEffect(() => {\n    if (firstRender.current) {\n      firstRender.current = false;\n      return;\n    }\n\n    cb();\n    // Dependencies are explicitly managed and the deps warning is enabled for the custom hook.\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, deps);\n};\n\nexport {useEffectAfterFirstRender};\n","import {Fragment, useCallback, useEffect, useMemo, useState} from 'react';\nimport {browserHistory, Link} from 'react-router';\nimport styled from '@emotion/styled';\nimport Fuse from 'fuse.js';\nimport * as qs from 'query-string';\n\nimport GridEditable, {\n  COL_WIDTH_UNDEFINED,\n  GridColumnOrder,\n} from 'sentry/components/gridEditable';\nimport * as Layout from 'sentry/components/layouts/thirds';\nimport Pagination from 'sentry/components/pagination';\nimport SearchBar from 'sentry/components/searchBar';\nimport SentryDocumentTitle from 'sentry/components/sentryDocumentTitle';\nimport {t} from 'sentry/locale';\nimport space from 'sentry/styles/space';\nimport trackAdvancedAnalyticsEvent from 'sentry/utils/analytics/trackAdvancedAnalyticsEvent';\nimport {Container, NumberContainer} from 'sentry/utils/discover/styles';\nimport {CallTreeNode} from 'sentry/utils/profiling/callTreeNode';\nimport {Profile} from 'sentry/utils/profiling/profile/profile';\nimport {generateProfileFlamechartRouteWithQuery} from 'sentry/utils/profiling/routes';\nimport {renderTableHead} from 'sentry/utils/profiling/tableRenderer';\nimport {makeFormatter} from 'sentry/utils/profiling/units/units';\nimport {decodeScalar} from 'sentry/utils/queryString';\nimport {useEffectAfterFirstRender} from 'sentry/utils/useEffectAfterFirstRender';\nimport {useLocation} from 'sentry/utils/useLocation';\nimport useOrganization from 'sentry/utils/useOrganization';\nimport {useParams} from 'sentry/utils/useParams';\n\nimport {useProfileGroup} from './profileGroupProvider';\n\nfunction collectTopProfileFrames(profile: Profile) {\n  const nodes: CallTreeNode[] = [];\n\n  profile.forEach(\n    node => {\n      if (node.selfWeight > 0) {\n        nodes.push(node);\n      }\n    },\n    () => {}\n  );\n\n  return (\n    nodes\n      .sort((a, b) => b.selfWeight - a.selfWeight)\n      // take only the slowest nodes from each thread because the rest\n      // aren't useful to display\n      .slice(0, 500)\n      .map(node => ({\n        symbol: node.frame.name,\n        image: node.frame.image,\n        thread: profile.threadId,\n        type: node.frame.is_application ? 'application' : 'system',\n        'self weight': node.selfWeight,\n        'total weight': node.totalWeight,\n      }))\n  );\n}\n\nconst RESULTS_PER_PAGE = 50;\n\nfunction ProfileDetails() {\n  const location = useLocation();\n  const [state] = useProfileGroup();\n  const organization = useOrganization();\n\n  useEffect(() => {\n    trackAdvancedAnalyticsEvent('profiling_views.profile_summary', {\n      organization,\n    });\n  }, [organization]);\n\n  const cursor = useMemo<number>(() => {\n    const cursorQuery = decodeScalar(location.query.cursor, '');\n    return parseInt(cursorQuery, 10) || 0;\n  }, [location.query.cursor]);\n\n  const query = useMemo<string>(() => decodeScalar(location.query.query, ''), [location]);\n\n  const allFunctions: TableDataRow[] = useMemo(() => {\n    return state.type === 'resolved'\n      ? state.data.profiles\n          .flatMap(collectTopProfileFrames)\n          // Self weight desc sort\n          .sort((a, b) => b['self weight'] - a['self weight'])\n      : [];\n  }, [state]);\n\n  const searchIndex = useMemo(() => {\n    return new Fuse(allFunctions, {\n      keys: ['symbol'],\n      threshold: 0.3,\n    });\n  }, [allFunctions]);\n\n  const search = useCallback(\n    (queryString: string) => {\n      if (!queryString) {\n        return allFunctions;\n      }\n      return searchIndex\n        .search(queryString)\n        .map(result => result.item)\n        .sort((a, b) => b['self weight'] - a['self weight']);\n    },\n    [searchIndex, allFunctions]\n  );\n\n  const [slowestFunctions, setSlowestFunctions] = useState<TableDataRow[]>(() => {\n    return search(query);\n  });\n\n  useEffectAfterFirstRender(() => {\n    setSlowestFunctions(search(query));\n  }, [allFunctions, query, search]);\n\n  const pageLinks = useMemo(() => {\n    const prevResults = cursor >= RESULTS_PER_PAGE ? 'true' : 'false';\n    const prevCursor = cursor >= RESULTS_PER_PAGE ? cursor - RESULTS_PER_PAGE : 0;\n    const prevQuery = {...location.query, cursor: prevCursor};\n    const prevHref = `${location.pathname}${qs.stringify(prevQuery)}`;\n    const prev = `<${prevHref}>; rel=\"previous\"; results=\"${prevResults}\"; cursor=\"${prevCursor}\"`;\n\n    const nextResults =\n      cursor + RESULTS_PER_PAGE < slowestFunctions.length ? 'true' : 'false';\n    const nextCursor =\n      cursor + RESULTS_PER_PAGE < slowestFunctions.length ? cursor + RESULTS_PER_PAGE : 0;\n    const nextQuery = {...location.query, cursor: nextCursor};\n    const nextHref = `${location.pathname}${qs.stringify(nextQuery)}`;\n    const next = `<${nextHref}>; rel=\"next\"; results=\"${nextResults}\"; cursor=\"${nextCursor}\"`;\n\n    return `${prev},${next}`;\n  }, [cursor, location, slowestFunctions]);\n\n  const handleSearch = useCallback(\n    searchString => {\n      browserHistory.replace({\n        ...location,\n        query: {\n          ...location.query,\n          query: searchString,\n          cursor: undefined,\n        },\n      });\n\n      setSlowestFunctions(search(searchString));\n    },\n    [location, search]\n  );\n\n  return (\n    <Fragment>\n      <SentryDocumentTitle\n        title={t('Profiling \\u2014 Details')}\n        orgSlug={organization.slug}\n      >\n        <Layout.Body>\n          <Layout.Main fullWidth>\n            <ActionBar>\n              <SearchBar\n                defaultQuery=\"\"\n                query={query}\n                placeholder={t('Search for frames')}\n                onChange={handleSearch}\n              />\n            </ActionBar>\n            <GridEditable\n              title={t('Slowest Functions')}\n              isLoading={state.type === 'loading'}\n              error={state.type === 'errored'}\n              data={slowestFunctions.slice(cursor, cursor + RESULTS_PER_PAGE)}\n              columnOrder={COLUMN_ORDER.map(key => COLUMNS[key])}\n              columnSortBy={[]}\n              grid={{\n                renderHeadCell: renderTableHead({\n                  rightAlignedColumns: RIGHT_ALIGNED_COLUMNS,\n                }),\n                renderBodyCell: renderFunctionCell,\n              }}\n              location={location}\n            />\n            <Pagination pageLinks={pageLinks} />\n          </Layout.Main>\n        </Layout.Body>\n      </SentryDocumentTitle>\n    </Fragment>\n  );\n}\n\nconst RIGHT_ALIGNED_COLUMNS = new Set<TableColumnKey>(['self weight', 'total weight']);\n\nconst ActionBar = styled('div')`\n  display: grid;\n  gap: ${space(2)};\n  grid-template-columns: auto;\n  margin-bottom: ${space(2)};\n`;\n\nfunction renderFunctionCell(\n  column: TableColumn,\n  dataRow: TableDataRow,\n  rowIndex: number,\n  columnIndex: number\n) {\n  return (\n    <ProfilingFunctionsTableCell\n      column={column}\n      dataRow={dataRow}\n      rowIndex={rowIndex}\n      columnIndex={columnIndex}\n    />\n  );\n}\n\ninterface ProfilingFunctionsTableCellProps {\n  column: TableColumn;\n  columnIndex: number;\n  dataRow: TableDataRow;\n  rowIndex: number;\n}\n\nconst formatter = makeFormatter('nanoseconds');\nfunction ProfilingFunctionsTableCell({\n  column,\n  dataRow,\n}: ProfilingFunctionsTableCellProps) {\n  const value = dataRow[column.key];\n  const {orgId, projectId, eventId} = useParams();\n\n  switch (column.key) {\n    case 'self weight':\n      return <NumberContainer>{formatter(value)}</NumberContainer>;\n    case 'total weight':\n      return <NumberContainer>{formatter(value)}</NumberContainer>;\n    case 'image':\n      return <Container>{value ?? 'Unknown'}</Container>;\n    case 'thread': {\n      return (\n        <Container>\n          <Link\n            to={generateProfileFlamechartRouteWithQuery({\n              orgSlug: orgId,\n              projectSlug: projectId,\n              profileId: eventId,\n              query: {tid: dataRow.thread},\n            })}\n          >\n            {value}\n          </Link>\n        </Container>\n      );\n    }\n    default:\n      return <Container>{value}</Container>;\n  }\n}\n\ntype TableColumnKey =\n  | 'symbol'\n  | 'image'\n  | 'self weight'\n  | 'total weight'\n  | 'thread'\n  | 'type';\ntype TableDataRow = Record<TableColumnKey, any>;\n\ntype TableColumn = GridColumnOrder<TableColumnKey>;\n\nconst COLUMN_ORDER: TableColumnKey[] = [\n  'symbol',\n  'image',\n  'thread',\n  'type',\n  'self weight',\n  'total weight',\n];\n\n// TODO: looks like these column names change depending on the platform?\nconst COLUMNS: Record<TableColumnKey, TableColumn> = {\n  symbol: {\n    key: 'symbol',\n    name: t('Symbol'),\n    width: COL_WIDTH_UNDEFINED,\n  },\n  image: {\n    key: 'image',\n    name: t('Binary'),\n    width: COL_WIDTH_UNDEFINED,\n  },\n  thread: {\n    key: 'thread',\n    name: t('Thread'),\n    width: COL_WIDTH_UNDEFINED,\n  },\n  type: {\n    key: 'type',\n    name: t('Type'),\n    width: COL_WIDTH_UNDEFINED,\n  },\n  'self weight': {\n    key: 'self weight',\n    name: t('Self Weight'),\n    width: COL_WIDTH_UNDEFINED,\n  },\n  'total weight': {\n    key: 'total weight',\n    name: t('Total Weight'),\n    width: COL_WIDTH_UNDEFINED,\n  },\n};\n\nexport default ProfileDetails;\n"],"names":["relativeChange","final","initial","durationMappings","nanoseconds","microseconds","milliseconds","seconds","format","v","abbrev","precision","toFixed","makeFormatter","from","multiplier","undefined","Error","value","duration","pad","n","slots","Math","floor","toString","padStart","makeTimelineFormatter","s","m","ms","useEffect","useRef","useEffectAfterFirstRender","cb","deps","firstRender","current","Fragment","useCallback","useMemo","useState","browserHistory","Link","Fuse","qs","GridEditable","COL_WIDTH_UNDEFINED","Layout","Pagination","SearchBar","SentryDocumentTitle","t","space","trackAdvancedAnalyticsEvent","Container","NumberContainer","generateProfileFlamechartRouteWithQuery","renderTableHead","decodeScalar","useLocation","useOrganization","useParams","useProfileGroup","collectTopProfileFrames","profile","nodes","forEach","node","selfWeight","push","sort","a","b","slice","map","symbol","frame","name","image","thread","threadId","type","is_application","totalWeight","RESULTS_PER_PAGE","ProfileDetails","location","state","organization","cursor","cursorQuery","query","parseInt","allFunctions","data","profiles","flatMap","searchIndex","keys","threshold","search","queryString","result","item","slowestFunctions","setSlowestFunctions","pageLinks","prevResults","prevCursor","prevQuery","prevHref","pathname","stringify","prev","nextResults","length","nextCursor","nextQuery","nextHref","next","handleSearch","searchString","replace","slug","COLUMN_ORDER","key","COLUMNS","renderHeadCell","rightAlignedColumns","RIGHT_ALIGNED_COLUMNS","renderBodyCell","renderFunctionCell","Set","ActionBar","column","dataRow","rowIndex","columnIndex","formatter","ProfilingFunctionsTableCell","orgId","projectId","eventId","orgSlug","projectSlug","profileId","tid","width"],"sourceRoot":""}