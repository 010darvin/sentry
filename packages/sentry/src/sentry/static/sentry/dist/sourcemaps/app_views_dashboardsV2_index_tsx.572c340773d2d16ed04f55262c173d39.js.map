{"version":3,"file":"chunks/app_views_dashboardsV2_index_tsx.xxxxxxxxxxxxxxxxxxxx.js","mappings":"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","sources":["webpack:///./app/views/dashboardsV2/index.tsx","webpack:///./app/views/dashboardsV2/orgDashboards.tsx","webpack:///./app/views/dashboardsV2/view.tsx"],"sourcesContent":["import {Fragment} from 'react';\nimport {RouteComponentProps} from 'react-router';\n\nimport {Client} from 'sentry/api';\nimport ErrorBoundary from 'sentry/components/errorBoundary';\nimport NotFound from 'sentry/components/errors/notFound';\nimport LoadingIndicator from 'sentry/components/loadingIndicator';\nimport {Organization} from 'sentry/types';\nimport withApi from 'sentry/utils/withApi';\nimport withOrganization from 'sentry/utils/withOrganization';\n\nimport DashboardDetail from './detail';\nimport OrgDashboards from './orgDashboards';\nimport {DashboardState} from './types';\nimport {DashboardBasicFeature} from './view';\n\ntype Props = RouteComponentProps<{orgId: string}, {}> & {\n  api: Client;\n  children: React.ReactNode;\n  organization: Organization;\n};\n\nfunction DashboardsV2Container(props: Props) {\n  const {organization, params, api, location, children} = props;\n\n  if (organization.features.includes('dashboards-edit')) {\n    return <Fragment>{children}</Fragment>;\n  }\n\n  return (\n    <DashboardBasicFeature organization={organization}>\n      <OrgDashboards\n        api={api}\n        location={location}\n        params={params}\n        organization={organization}\n      >\n        {({dashboard, dashboards, error, onDashboardUpdate}) => {\n          return error ? (\n            <NotFound />\n          ) : dashboard ? (\n            <ErrorBoundary>\n              <DashboardDetail\n                {...props}\n                initialState={DashboardState.VIEW}\n                dashboard={dashboard}\n                dashboards={dashboards}\n                onDashboardUpdate={onDashboardUpdate}\n              />\n            </ErrorBoundary>\n          ) : (\n            <LoadingIndicator />\n          );\n        }}\n      </OrgDashboards>\n    </DashboardBasicFeature>\n  );\n}\n\nexport default withApi(withOrganization(DashboardsV2Container));\n","import {browserHistory} from 'react-router';\nimport {Location} from 'history';\nimport isEmpty from 'lodash/isEmpty';\nimport isEqual from 'lodash/isEqual';\n\nimport {Client} from 'sentry/api';\nimport AsyncComponent from 'sentry/components/asyncComponent';\nimport NotFound from 'sentry/components/errors/notFound';\nimport LoadingIndicator from 'sentry/components/loadingIndicator';\nimport SentryDocumentTitle from 'sentry/components/sentryDocumentTitle';\nimport {t} from 'sentry/locale';\nimport {PageContent} from 'sentry/styles/organization';\nimport {Organization} from 'sentry/types';\nimport {trackAnalyticsEvent} from 'sentry/utils/analytics';\n\nimport {assignTempId} from './layoutUtils';\nimport {DashboardDetails, DashboardListItem} from './types';\nimport {hasSavedPageFilters} from './utils';\n\ntype OrgDashboardsChildrenProps = {\n  dashboard: DashboardDetails | null;\n  dashboards: DashboardListItem[];\n  error: boolean;\n  onDashboardUpdate: (updatedDashboard: DashboardDetails) => void;\n};\n\ntype Props = {\n  api: Client;\n  children: (props: OrgDashboardsChildrenProps) => React.ReactNode;\n  location: Location;\n  organization: Organization;\n  params: {orgId: string; dashboardId?: string};\n};\n\ntype State = {\n  // endpoint response\n  dashboards: DashboardListItem[] | null;\n  /**\n   * The currently selected dashboard.\n   */\n  selectedDashboard: DashboardDetails | null;\n} & AsyncComponent['state'];\n\nclass OrgDashboards extends AsyncComponent<Props, State> {\n  state: State = {\n    // AsyncComponent state\n    loading: true,\n    reloading: false,\n    error: false,\n    errors: {},\n\n    dashboards: [],\n    selectedDashboard: null,\n  };\n\n  componentDidUpdate(prevProps: Props) {\n    if (!isEqual(prevProps.params.dashboardId, this.props.params.dashboardId)) {\n      this.remountComponent();\n    }\n  }\n\n  getEndpoints(): ReturnType<AsyncComponent['getEndpoints']> {\n    const {organization, params} = this.props;\n    const url = `/organizations/${organization.slug}/dashboards/`;\n    const endpoints: ReturnType<AsyncComponent['getEndpoints']> = [['dashboards', url]];\n\n    if (params.dashboardId) {\n      endpoints.push(['selectedDashboard', `${url}${params.dashboardId}/`]);\n      trackAnalyticsEvent({\n        eventKey: 'dashboards2.view',\n        eventName: 'Dashboards2: View dashboard',\n        organization_id: parseInt(this.props.organization.id, 10),\n        dashboard_id: params.dashboardId,\n      });\n    }\n\n    return endpoints;\n  }\n\n  onDashboardUpdate(updatedDashboard: DashboardDetails) {\n    this.setState({selectedDashboard: updatedDashboard});\n  }\n\n  getDashboards(): DashboardListItem[] {\n    const {dashboards} = this.state;\n\n    return Array.isArray(dashboards) ? dashboards : [];\n  }\n\n  onRequestSuccess({stateKey, data}) {\n    const {params, organization, location} = this.props;\n\n    if (params.dashboardId || stateKey === 'selectedDashboard') {\n      const queryParamFilters = new Set([\n        'project',\n        'environment',\n        'statsPeriod',\n        'start',\n        'end',\n        'utc',\n        'release',\n      ]);\n      if (\n        organization.features.includes('dashboards-top-level-filter') &&\n        stateKey === 'selectedDashboard' &&\n        // Only redirect if there are saved filters and none of the filters\n        // appear in the query params\n        hasSavedPageFilters(data) &&\n        isEmpty(\n          Object.keys(location.query).filter(unsavedQueryParam =>\n            queryParamFilters.has(unsavedQueryParam)\n          )\n        )\n      ) {\n        browserHistory.replace({\n          ...location,\n          query: {\n            ...location.query,\n            project: data.projects,\n            environment: data.environment,\n            statsPeriod: data.period,\n            start: data.start,\n            end: data.end,\n            utc: data.utc,\n          },\n        });\n      }\n      return;\n    }\n\n    // If we don't have a selected dashboard, and one isn't going to arrive\n    // we can redirect to the first dashboard in the list.\n    const dashboardId = data.length ? data[0].id : 'default-overview';\n    const url = `/organizations/${organization.slug}/dashboard/${dashboardId}/`;\n    browserHistory.replace({\n      pathname: url,\n      query: {\n        ...location.query,\n      },\n    });\n  }\n\n  renderLoading() {\n    return (\n      <PageContent>\n        <LoadingIndicator />\n      </PageContent>\n    );\n  }\n\n  renderBody() {\n    const {children, organization} = this.props;\n    const {selectedDashboard, error} = this.state;\n    let dashboard = selectedDashboard;\n\n    if (organization.features.includes('dashboard-grid-layout')) {\n      // Ensure there are always tempIds for grid layout\n      // This is needed because there are cases where the dashboard\n      // renders before the onRequestSuccess setState is processed\n      // and will caused stacked widgets because of missing tempIds\n      dashboard = selectedDashboard\n        ? {\n            ...selectedDashboard,\n            widgets: selectedDashboard.widgets.map(assignTempId),\n          }\n        : null;\n    }\n\n    return children({\n      error,\n      dashboard,\n      dashboards: this.getDashboards(),\n      onDashboardUpdate: (updatedDashboard: DashboardDetails) =>\n        this.onDashboardUpdate(updatedDashboard),\n    });\n  }\n\n  renderError(error: Error) {\n    const notFound = Object.values(this.state.errors).find(\n      resp => resp && resp.status === 404\n    );\n\n    if (notFound) {\n      return <NotFound />;\n    }\n\n    return super.renderError(error, true);\n  }\n\n  renderComponent() {\n    const {organization, location} = this.props;\n    const {loading, selectedDashboard} = this.state;\n\n    if (!organization.features.includes('dashboards-basic')) {\n      // Redirect to Dashboards v1\n      browserHistory.replace({\n        pathname: `/organizations/${organization.slug}/dashboards/`,\n        query: {\n          ...location.query,\n        },\n      });\n      return null;\n    }\n\n    if (\n      loading &&\n      organization.features.includes('dashboards-top-level-filter') &&\n      selectedDashboard &&\n      hasSavedPageFilters(selectedDashboard) &&\n      isEmpty(location.query)\n    ) {\n      // Block dashboard from rendering if the dashboard has filters and\n      // the URL does not contain filters yet. The filters can either match the\n      // saved filters, or can be different (i.e. sharing an unsaved state)\n      return this.renderLoading();\n    }\n\n    return (\n      <SentryDocumentTitle title={t('Dashboards')} orgSlug={organization.slug}>\n        {super.renderComponent() as React.ReactChild}\n      </SentryDocumentTitle>\n    );\n  }\n}\n\nexport default OrgDashboards;\n","import {useEffect, useState} from 'react';\nimport {browserHistory, RouteComponentProps} from 'react-router';\nimport pick from 'lodash/pick';\n\nimport {updateDashboardVisit} from 'sentry/actionCreators/dashboards';\nimport Feature from 'sentry/components/acl/feature';\nimport Alert from 'sentry/components/alert';\nimport ErrorBoundary from 'sentry/components/errorBoundary';\nimport NotFound from 'sentry/components/errors/notFound';\nimport LoadingIndicator from 'sentry/components/loadingIndicator';\nimport {t} from 'sentry/locale';\nimport {PageContent} from 'sentry/styles/organization';\nimport {Organization} from 'sentry/types';\nimport useApi from 'sentry/utils/useApi';\nimport withOrganization from 'sentry/utils/withOrganization';\n\nimport DashboardDetail from './detail';\nimport OrgDashboards from './orgDashboards';\nimport {DashboardState, Widget} from './types';\nimport {constructWidgetFromQuery} from './utils';\n\nconst ALLOWED_PARAMS = [\n  'start',\n  'end',\n  'utc',\n  'period',\n  'project',\n  'environment',\n  'statsPeriod',\n];\n\ntype Props = RouteComponentProps<\n  {dashboardId: string; orgId: string; widgetId?: number},\n  {}\n> & {\n  children: React.ReactNode;\n  organization: Organization;\n};\n\nfunction ViewEditDashboard(props: Props) {\n  const api = useApi();\n\n  const {organization, params, location} = props;\n  const dashboardId = params.dashboardId;\n  const orgSlug = organization.slug;\n  const [newWidget, setNewWidget] = useState<Widget | undefined>();\n  const [dashboardInitialState, setDashboardInitialState] = useState(DashboardState.VIEW);\n\n  useEffect(() => {\n    if (dashboardId && dashboardId !== 'default-overview') {\n      updateDashboardVisit(api, orgSlug, dashboardId);\n    }\n  }, [api, orgSlug, dashboardId]);\n\n  useEffect(() => {\n    const constructedWidget = constructWidgetFromQuery(location.query);\n    setNewWidget(constructedWidget);\n    // Clean up url after constructing widget from query string, only allow GHS params\n    if (constructedWidget) {\n      setDashboardInitialState(DashboardState.EDIT);\n      browserHistory.replace({\n        pathname: location.pathname,\n        query: pick(location.query, ALLOWED_PARAMS),\n      });\n    }\n  }, [location.pathname]);\n\n  return (\n    <DashboardBasicFeature organization={organization}>\n      <OrgDashboards\n        api={api}\n        location={location}\n        params={params}\n        organization={organization}\n      >\n        {({dashboard, dashboards, error, onDashboardUpdate}) => {\n          return error ? (\n            <NotFound />\n          ) : dashboard ? (\n            <ErrorBoundary>\n              <DashboardDetail\n                {...props}\n                initialState={dashboardInitialState}\n                dashboard={dashboard}\n                dashboards={dashboards}\n                onDashboardUpdate={onDashboardUpdate}\n                newWidget={newWidget}\n                onSetNewWidget={() => setNewWidget(undefined)}\n              />\n            </ErrorBoundary>\n          ) : (\n            <LoadingIndicator />\n          );\n        }}\n      </OrgDashboards>\n    </DashboardBasicFeature>\n  );\n}\n\nexport default withOrganization(ViewEditDashboard);\n\ntype FeatureProps = {\n  children: React.ReactNode;\n  organization: Organization;\n};\n\nexport const DashboardBasicFeature = ({organization, children}: FeatureProps) => {\n  const renderDisabled = () => (\n    <PageContent>\n      <Alert type=\"warning\">{t(\"You don't have access to this feature\")}</Alert>\n    </PageContent>\n  );\n\n  return (\n    <Feature\n      hookName=\"feature-disabled:dashboards-page\"\n      features={['organizations:dashboards-basic']}\n      organization={organization}\n      renderDisabled={renderDisabled}\n    >\n      {children}\n    </Feature>\n  );\n};\n"],"names":["Fragment","ErrorBoundary","NotFound","LoadingIndicator","withApi","withOrganization","DashboardDetail","OrgDashboards","DashboardState","DashboardBasicFeature","DashboardsV2Container","props","organization","params","api","location","children","features","includes","dashboard","dashboards","error","onDashboardUpdate","VIEW","browserHistory","isEmpty","isEqual","AsyncComponent","SentryDocumentTitle","t","PageContent","trackAnalyticsEvent","assignTempId","hasSavedPageFilters","loading","reloading","errors","selectedDashboard","componentDidUpdate","prevProps","dashboardId","remountComponent","getEndpoints","url","slug","endpoints","push","eventKey","eventName","organization_id","parseInt","id","dashboard_id","updatedDashboard","setState","getDashboards","state","Array","isArray","onRequestSuccess","stateKey","data","queryParamFilters","Set","Object","keys","query","filter","unsavedQueryParam","has","replace","project","projects","environment","statsPeriod","period","start","end","utc","length","pathname","renderLoading","renderBody","widgets","map","renderError","notFound","values","find","resp","status","renderComponent","useEffect","useState","pick","updateDashboardVisit","Feature","Alert","useApi","constructWidgetFromQuery","ALLOWED_PARAMS","ViewEditDashboard","orgSlug","newWidget","setNewWidget","dashboardInitialState","setDashboardInitialState","constructedWidget","EDIT","undefined","renderDisabled"],"sourceRoot":""}